{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\thupa\\\\OneDrive\\\\Desktop\\\\fuel\\\\fuel-frontend\\\\src\\\\pages\\\\CheckoutPage.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, PaymentElement, useStripe, useElements } from '@stripe/react-stripe-js';\n\n// ⚠️ IMPORTANT: Add your STRIPE PUBLISHABLE KEY here\n// This key is different from your SECRET KEY. It's safe to use in the frontend.\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe('YOUR_STRIPE_PUBLISHABLE_KEY');\n\n// This is the inner component that has access to Stripe\nconst CheckoutForm = ({\n  clientSecret,\n  bookingDetails,\n  totalPrice,\n  token\n}) => {\n  _s();\n  const stripe = useStripe();\n  const elements = useElements();\n  const navigate = useNavigate();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState(null);\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!stripe || !elements) {\n      return; // Stripe.js has not yet loaded.\n    }\n    setIsProcessing(true);\n    setError(null);\n\n    // 1. Confirm the payment with Stripe\n    const {\n      error: stripeError,\n      paymentIntent\n    } = await stripe.confirmPayment({\n      elements,\n      confirmParams: {\n        // This return_url is not strictly needed here since we handle the result\n        return_url: `${window.location.origin}/dashboard`\n      },\n      redirect: 'if_required' // Prevents automatic redirect\n    });\n    if (stripeError) {\n      setError(stripeError.message);\n      setIsProcessing(false);\n      return;\n    }\n\n    // 2. If payment is successful, NOW create the booking\n    if (paymentIntent.status === 'succeeded') {\n      try {\n        const response = await fetch('http://localhost:5000/api/bookings', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${token}`\n          },\n          // Send the booking details AND the payment info\n          body: JSON.stringify({\n            ...bookingDetails,\n            isPaid: true,\n            paymentId: paymentIntent.id // Store the payment ID\n          })\n        });\n        const data = await response.json();\n        if (response.ok) {\n          alert('Payment Successful! Your priority booking is confirmed.');\n          navigate('/dashboard');\n        } else {\n          setError(data.msg || 'Payment succeeded but booking failed. Please contact support.');\n        }\n      } catch (err) {\n        setError('Payment succeeded but booking creation failed. Please contact support.');\n      }\n    } else {\n      setError('Payment was not successful. Please try again.');\n    }\n    setIsProcessing(false);\n  };\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    id: \"payment-form\",\n    onSubmit: handleSubmit,\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"text-xl font-semibold mb-4\",\n      children: [\"Pay \\u20B9\", totalPrice.toFixed(2)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PaymentElement, {\n      id: \"payment-element\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      disabled: isProcessing || !stripe || !elements,\n      id: \"submit\",\n      className: \"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-300 mt-6\",\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        id: \"button-text\",\n        children: isProcessing ? \"Processing...\" : \"Pay Now\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"payment-message\",\n      className: \"text-red-500 mt-4 text-center\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 5\n  }, this);\n};\n\n// This is the main page component that loads Stripe\n_s(CheckoutForm, \"zAtzbmiSQDs95Ges8zctwpgMeMY=\", false, function () {\n  return [useStripe, useElements, useNavigate];\n});\n_c = CheckoutForm;\nexport default function CheckoutPage() {\n  _s2();\n  const {\n    state\n  } = useLocation();\n  const token = localStorage.getItem('token'); // Get token for the form\n\n  if (!state || !state.clientSecret || !state.bookingDetails) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-8 text-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-2xl font-bold text-red-600\",\n        children: \"Error\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"No payment details found. Please try booking again.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this);\n  }\n  const {\n    clientSecret,\n    bookingDetails,\n    totalPrice\n  } = state;\n  const options = {\n    clientSecret,\n    appearance: {\n      theme: 'stripe'\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4 md:p-8\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"max-w-lg mx-auto bg-white rounded-lg shadow-lg p-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-3xl font-bold text-center text-gray-800 mb-6\",\n        children: \"Complete Your Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Elements, {\n        options: options,\n        stripe: stripePromise,\n        children: /*#__PURE__*/_jsxDEV(CheckoutForm, {\n          clientSecret: clientSecret,\n          bookingDetails: bookingDetails,\n          totalPrice: totalPrice,\n          token: token\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 120,\n    columnNumber: 5\n  }, this);\n}\n_s2(CheckoutPage, \"FO3uhfHQFxifE5/pZVC1vAVIA9s=\", false, function () {\n  return [useLocation];\n});\n_c2 = CheckoutPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"CheckoutForm\");\n$RefreshReg$(_c2, \"CheckoutPage\");","map":{"version":3,"names":["React","useState","useLocation","useNavigate","loadStripe","Elements","PaymentElement","useStripe","useElements","jsxDEV","_jsxDEV","stripePromise","CheckoutForm","clientSecret","bookingDetails","totalPrice","token","_s","stripe","elements","navigate","isProcessing","setIsProcessing","error","setError","handleSubmit","e","preventDefault","stripeError","paymentIntent","confirmPayment","confirmParams","return_url","window","location","origin","redirect","message","status","response","fetch","method","headers","body","JSON","stringify","isPaid","paymentId","id","data","json","ok","alert","msg","err","onSubmit","children","className","toFixed","fileName","_jsxFileName","lineNumber","columnNumber","disabled","_c","CheckoutPage","_s2","state","localStorage","getItem","options","appearance","theme","_c2","$RefreshReg$"],"sources":["C:/Users/thupa/OneDrive/Desktop/fuel/fuel-frontend/src/pages/CheckoutPage.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Elements, PaymentElement, useStripe, useElements } from '@stripe/react-stripe-js';\r\n\r\n// ⚠️ IMPORTANT: Add your STRIPE PUBLISHABLE KEY here\r\n// This key is different from your SECRET KEY. It's safe to use in the frontend.\r\nconst stripePromise = loadStripe('YOUR_STRIPE_PUBLISHABLE_KEY');\r\n\r\n// This is the inner component that has access to Stripe\r\nconst CheckoutForm = ({ clientSecret, bookingDetails, totalPrice, token }) => {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const navigate = useNavigate();\r\n  \r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!stripe || !elements) {\r\n      return; // Stripe.js has not yet loaded.\r\n    }\r\n\r\n    setIsProcessing(true);\r\n    setError(null);\r\n\r\n    // 1. Confirm the payment with Stripe\r\n    const { error: stripeError, paymentIntent } = await stripe.confirmPayment({\r\n      elements,\r\n      confirmParams: {\r\n        // This return_url is not strictly needed here since we handle the result\r\n        return_url: `${window.location.origin}/dashboard`,\r\n      },\r\n      redirect: 'if_required', // Prevents automatic redirect\r\n    });\r\n\r\n    if (stripeError) {\r\n      setError(stripeError.message);\r\n      setIsProcessing(false);\r\n      return;\r\n    }\r\n\r\n    // 2. If payment is successful, NOW create the booking\r\n    if (paymentIntent.status === 'succeeded') {\r\n      try {\r\n        const response = await fetch('http://localhost:5000/api/bookings', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token}` \r\n          },\r\n          // Send the booking details AND the payment info\r\n          body: JSON.stringify({ \r\n            ...bookingDetails, \r\n            isPaid: true,\r\n            paymentId: paymentIntent.id // Store the payment ID\r\n          })\r\n        });\r\n\r\n        const data = await response.json();\r\n        if (response.ok) {\r\n          alert('Payment Successful! Your priority booking is confirmed.');\r\n          navigate('/dashboard');\r\n        } else {\r\n          setError(data.msg || 'Payment succeeded but booking failed. Please contact support.');\r\n        }\r\n\r\n      } catch (err) {\r\n        setError('Payment succeeded but booking creation failed. Please contact support.');\r\n      }\r\n    } else {\r\n      setError('Payment was not successful. Please try again.');\r\n    }\r\n\r\n    setIsProcessing(false);\r\n  };\r\n\r\n  return (\r\n    <form id=\"payment-form\" onSubmit={handleSubmit}>\r\n      <h3 className=\"text-xl font-semibold mb-4\">Pay ₹{totalPrice.toFixed(2)}</h3>\r\n      <PaymentElement id=\"payment-element\" />\r\n      <button \r\n        disabled={isProcessing || !stripe || !elements} \r\n        id=\"submit\"\r\n        className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-300 mt-6\"\r\n      >\r\n        <span id=\"button-text\">\r\n          {isProcessing ? \"Processing...\" : \"Pay Now\"}\r\n        </span>\r\n      </button>\r\n      {error && <div id=\"payment-message\" className=\"text-red-500 mt-4 text-center\">{error}</div>}\r\n    </form>\r\n  );\r\n};\r\n\r\n// This is the main page component that loads Stripe\r\nexport default function CheckoutPage() {\r\n  const { state } = useLocation();\r\n  const token = localStorage.getItem('token'); // Get token for the form\r\n\r\n  if (!state || !state.clientSecret || !state.bookingDetails) {\r\n    return (\r\n      <div className=\"p-8 text-center\">\r\n        <h2 className=\"text-2xl font-bold text-red-600\">Error</h2>\r\n        <p>No payment details found. Please try booking again.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const { clientSecret, bookingDetails, totalPrice } = state;\r\n\r\n  const options = {\r\n    clientSecret,\r\n    appearance: { theme: 'stripe' },\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-8\">\r\n      <div className=\"max-w-lg mx-auto bg-white rounded-lg shadow-lg p-8\">\r\n        <h2 className=\"text-3xl font-bold text-center text-gray-800 mb-6\">\r\n          Complete Your Payment\r\n        </h2>\r\n        <Elements options={options} stripe={stripePromise}>\r\n          <CheckoutForm \r\n            clientSecret={clientSecret}\r\n            bookingDetails={bookingDetails}\r\n            totalPrice={totalPrice}\r\n            token={token}\r\n          />\r\n        </Elements>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}